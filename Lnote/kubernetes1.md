## 容器技术
应用程序仅由较少数量的大组件构成时，可以给每个组件分配专用的虚拟机来隔离他们的环境。但是，组件更小，数量更多时，继续使用虚拟机来隔离得话，会浪费硬件资源，增加人力资源。
### Linux容器技术隔离组件
#### 虚拟机和容器
##### 虚拟机
- 管理程序将物理资源分成较小部分的`虚拟硬件资源`，从而被虚拟机中的操作系统使用。
- `系统调用`：运行在虚拟机中的应用程序，会执行虚拟机操作系统的系统调用。虚拟机操作系统通过管理程序在宿主机上的物理CPU执行x86指令。
##### 虚拟机和容器对比
- 容器比虚拟机更加轻量级，虚拟机需要运行自己的一组系统进程，容器不需要。**使用容器时，能够也应该让每个应用有一个容器**。
- 多个容器会完全执行运行在宿主机上的同一个内核的系统调用。而虚拟机提供完全隔离的环境，每个虚拟机运行在自己的Linux内核。（虚拟机的优点）
- 运行容器不需要像运行虚拟机一样开机，容器进程可以很快被启动。

### 容器实现隔离原理
#### Linux命名空间
- 使每个进程只看到自己的系统视图（文件、进程、网络接口、主机名等）
#### Linux控制组cgroups
限制进程能够使用的资源量

### docker
- 镜像

#### docker镜像是如何构建的?
1.Docker的客户端和守护进程不要求在同一台机器上
2.Docker客户端将 **整个目录的文件**上传到Docker守护进程
3.由Docker守护进程构建新的镜像

tips: 不要在构建目录中包含任何不需要的文件，尤其当Docker守护进程运行在一个远端机器的时候。
- 镜像仓库
- 容器

#### 虚拟机与docker容器
##### docker容器的镜像层
**docker镜像由多层构成** docker镜像和虚拟机镜像的一个很大的不同就在于：容器镜像是由多层构成。docker镜像能够在多个镜像之间共享和征用。共享：基于相同基础层的镜像被创建成两个容器时，他们能够读相同的文件。**但，容器镜像是只读的**，其中一个容器写入某些文件对另外的容器是不可见的。层不仅使得镜像在网络上的分发效率提高，还有助于减少镜像的存储空间。
- Dockerfile中每一条单独的指令都会创建一个新层。

### Kubernetes
#### Kubernets集群架构
一个Kubernets集群由很多节点组成。
- 主节点：承载Kubernetes控制和管理整个集群系统的控制面板
- 工作节点：运行用户实际部署的应用
##### 控制面板
- Kubernetes API服务器
- Scheculer:调度应用，为应用的每个可部署组件分配一个工作节点
- Controller Manager: 执行集群级别的功能，复制组件、持续跟踪工作节点、处理节点失败
- etcd: 一个可靠的分布式数据存储，能持久化存储集群配置。

##### 工作节点
- Docker rtk 或其他的容器类型
- Kubelet: 与API服务器通信，并管理它所在节点的容器
- kube-proxy: 负责组件间的负载均衡网络流量

